<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Hasil Unduh â€” TikTok Downloader</title>
  <link rel="icon" type="image/jpeg" href="https://i.postimg.cc/KYjVHcHf/1761372755063-1.jpg" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --primary: #647cf7;
      --primary-light: #7b8cff;
      --bg: #131627;
      --text: #d5d7e3;
      --border-glow: rgba(255, 255, 255, 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      background-color: #0e1120;
      font-family: 'Inter', sans-serif;
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 0 16px 110px;
      overflow-x: hidden;
      line-height: 1.6;
    }

    /* === HEADBAR === */
    .top-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: rgba(10, 12, 25, 0.7);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border-glow);
      z-index: 99999;
      box-shadow: 0 2px 20px rgba(83, 101, 247, 0.1);
    }

    .logo {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: var(--primary-light);
      text-shadow: 0 0 12px rgba(200, 230, 255, 0.3);
      font-family: 'Orbitron', sans-serif;
    }

    .nav-icon-btn {
      background: transparent;
      border: none;
      color: #ffffff;
      cursor: pointer;
      padding: 8px;
      transition: all 0.3s ease;
    }

    .nav-icon-btn:hover {
      color: var(--primary);
      text-shadow: 0 0 8px rgba(83, 101, 247, 0.8);
    }

    /* === MAIN CONTENT === */
    #mainPage {
      padding-top: max(92px, calc(env(safe-area-inset-top, 20px) + 80px));
    }

    .container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .card {
      background: var(--bg);
      border-radius: 18px;
      padding: 24px;
      border: 1px solid var(--border-glow);
      box-shadow: 0 0 22px rgba(83, 101, 247, 0.08);
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 0 28px rgba(83, 101, 247, 0.25);
    }

    /* Video Info Section */
    .video-header {
      display: flex;
      gap: 16px;
      margin-bottom: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .video-thumbnail {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 12px;
      border: 1px solid var(--border-glow);
      flex-shrink: 0;
    }

    .video-details {
      flex: 1;
      min-width: 0;
    }

    .video-details h2 {
      font-size: 1.1rem;
      margin-bottom: 8px;
      color: white;
      word-break: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      max-width: 100%;
    }

    .video-meta {
      font-size: 0.85rem;
      color: #a8aab7;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 8px;
    }

    /* Download Card */
    .download-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: rgba(20, 25, 45, 0.4);
      border-radius: 14px;
      gap: 12px;
    }

    .quality-badge {
      display: inline-block;
      padding: 2px 8px;
      background: linear-gradient(135deg, #10b981, #14b8a6);
      color: white;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-left: 6px;
    }

    /* Music Card */
    .music-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: rgba(236, 72, 153, 0.1);
      border: 1px solid rgba(236, 72, 153, 0.3);
      border-radius: 14px;
    }

    .music-cover {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      object-fit: cover;
    }

    /* Tombol */
    .download-btn,
    .btn-copy-caption {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-family: 'Orbitron', sans-serif;
      font-weight: 600;
      font-size: 0.9rem;
      color: white;
      padding: 12px 24px;
      border-radius: 50px;
      letter-spacing: 1px;
      cursor: pointer;
      white-space: nowrap;
      min-width: 130px;
      text-align: center;
      border: none;
      outline: none;
      overflow: hidden;
      will-change: transform;
    }

    .download-btn {
      background: linear-gradient(90deg, #5365F7, #6b7dff);
      box-shadow: 0 4px 16px rgba(83, 101, 247, 0.3);
    }

    .btn-copy-caption {
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
    }

    /* Foto Item */
    .photo-item {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid var(--border-glow);
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .photo-item:hover {
      transform: scale(1.08);
      box-shadow: 0 0 12px rgba(236, 72, 153, 0.4);
    }

    /* Error Section */
    .error-section {
      text-align: center;
      padding: 40px 20px;
      background: var(--bg);
      border: 1px solid var(--border-glow);
      border-radius: 18px;
      color: white;
    }

    /* Navbar Bawah */
    .nav-bottom {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: rgba(20, 20, 28, 0.9);
      backdrop-filter: blur(12px);
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      padding: 0.55rem 0;
      height: 58px;
      width: 100%;
      z-index: 1000;
    }

    .nav-btn {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #a1a1aa;
      flex: 1;
      transition: all 0.3s ease;
    }

    .nav-btn i { font-size: 1.35rem; }
    .nav-btn span { font-size: 0.66rem; margin-top: 0.15rem; font-family: "Poppins", sans-serif; opacity: 0.65; }
    .nav-btn.active span { font-weight: 600; color: white; }

    .nav-btn::after {
      content: "";
      position: absolute;
      bottom: -4px;
      left: 50%;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #5b6ef6, #60a5fa);
      transform: translateX(-50%);
      border-radius: 2px;
      transition: width 0.35s ease;
    }

    .nav-btn:hover::after, .nav-btn.active::after { width: 26px; }
    .nav-btn.active::after { animation: underlineBreath 2s ease-in-out infinite; }

    @keyframes underlineBreath {
      0%, 100% { width: 22px; }
      50% { width: 32px; }
    }

    /* Responsive */
    @media (max-width: 650px) {
      .video-header { flex-direction: column; align-items: center; text-align: center; }
      .video-thumbnail { width: 120px; height: 120px; }
      .download-card { flex-direction: column; text-align: center; }
      .download-btn, .btn-copy-caption { width: 100%; justify-content: center; }
      .music-card { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
  <!-- HEADBAR -->
  <div class="top-nav">
    <a href="index.html" class="nav-icon-btn" style="color:white; text-decoration:none;">
      <i class="fas fa-arrow-left"></i>
    </a>
    <div class="logo">SNAPBER</div>
    <button class="nav-icon-btn" onclick="alert('Profile')">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
    </button>
  </div>

  <!-- MAIN CONTENT -->
  <div id="mainPage" class="dark-verse-container">
    <div class="container">
      <div id="errorSection" class="error-section" style="display:none;">
        <div class="text-6xl mb-4 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-600 text-transparent bg-clip-text">
          <i class="fa-solid fa-triangle-exclamation"></i>
        </div>
        <h2 style="color:white; margin-bottom:12px;">Data Tidak Ditemukan</h2>
        <p style="color:#a8aab7; margin-bottom:20px;">Silakan kembali dan coba lagi.</p>
        <a href="index.html" class="download-btn" style="background:linear-gradient(90deg, #ef4444, #f97316);">
          <i class="fas fa-home"></i> Kembali ke Beranda
        </a>
      </div>

      <div id="videoInfoCard" class="card" style="display:none;">
        <div class="video-header">
          <img src="" alt="Thumbnail" class="video-thumbnail" id="thumbnailImg">
          <div class="video-details">
            <h2 id="videoTitle"></h2>
            <div class="video-meta">
              <span><i class="fas fa-clock"></i> <span id="videoDuration"></span>s</span>
              <span><i class="fas fa-calendar"></i> <span id="videoDate"></span></span>
              <span><i class="fas fa-map-marker-alt"></i> <span id="videoRegion"></span></span>
            </div>
            <button class="btn-copy-caption" onclick="copyCaption()">
              <i class="fas fa-copy"></i> Salin Caption
            </button>
          </div>
        </div>
      </div>

      <div id="downloadSection" class="card" style="display:none;">
        <h3 class="section-title"><i class="fas fa-download"></i> Unduh Video</h3>
        <div class="download-card">
          <div>
            <div style="font-weight:600; display:flex; align-items:center; gap:8px;">
              <i class="fas fa-video"></i> Video HD
              <span class="quality-badge">HD â€¢ No WM</span>
            </div>
            <div style="font-size:0.85rem; color:#a8aab7;">
              Tanpa watermark â€¢ <span id="videoSize"></span>
            </div>
          </div>
          <button class="download-btn" onclick="downloadVideo()">
            <i class="fas fa-download"></i> UNDUH
          </button>
        </div>
      </div>

      <div id="musicSection" class="card" style="display:none;">
        <h3 class="section-title"><i class="fas fa-music"></i> Audio Asli</h3>
        <div class="music-card">
          <img src="" alt="Music" class="music-cover" id="musicCover">
          <div style="flex:1;">
            <div style="font-weight:600;" id="musicTitle"></div>
            <div style="font-size:0.85rem; color:#a8aab7;" id="musicAuthor"></div>
          </div>
          <button class="download-btn" onclick="downloadAudio()">
            <i class="fas fa-download"></i> Unduh Audio
          </button>
        </div>
      </div>

      <!-- Photo Section -->
      <div id="photoSection" class="card" style="display:none;">
        <h3 class="section-title" style="font-family: 'Orbitron', sans-serif; color: white; margin-bottom: 16px;">
          <i class="fas fa-images"></i> Unduh Foto
        </h3>
        <button class="download-btn" onclick="downloadAllPhotos()" style="background: linear-gradient(90deg, #ec4899, #f472b6); margin-bottom: 16px;">
          <i class="fas fa-download"></i> UNDUH SEMUA FOTO
        </button>
        <div id="photoList" style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;"></div>
      </div>
    </div>
  </div>

  <!-- NAVIGASI BAWAH -->
  <nav class="nav-bottom">
    <a href="index.html" class="nav-btn">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </a>
    <a href="nokos.html" class="nav-btn">
      <i class="fas fa-phone"></i>
      <span>Nokos</span>
    </a>
    <a href="blast.html" class="nav-btn">
      <i class="fas fa-bolt"></i>
      <span>Blast</span>
    </a>
    <a href="snapber.html" class="nav-btn active">
      <i class="fas fa-film"></i>
      <span>SnapBer</span>
    </a>
    <a href="upgrade.html" class="nav-btn">
      <i class="fas fa-crown"></i>
      <span>Upgrade</span>
    </a>
  </nav>

  <script>
    // === FUNGSI BANTU ===
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num;
    }

    function formatFileSize(bytes) {
      if (!bytes || bytes <= 0) return 'â€“';
      if (bytes >= 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
      if (bytes >= 1024) return (bytes / 1024).toFixed(2) + ' KB';
      return bytes + ' B';
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
    }

    function downloadFile(url, filename) {
      url = url.trim();
      const win = window.open(url, '_blank');
      if (win) {
        alert(
          "âœ… File terbuka di tab baru.\n\n" +
          "ðŸ‘‰ Klik kanan pada file â†’ pilih 'Simpan sebagai...'\n" +
          "ðŸ“ File: " + filename
        );
      } else {
        alert("âŒ Popup diblokir! Izinkan popup di browser Anda.");
      }
    }

    function downloadVideo() {
      const data = JSON.parse(sessionStorage.getItem('tiktokData'));
      downloadFile(data.hdplay, 'tiktok-hd.mp4');
    }

    function downloadAudio() {
      const data = JSON.parse(sessionStorage.getItem('tiktokData'));
      downloadFile(data.music_info.play, 'tiktok-audio.mp3');
    }

    function downloadPhoto(url, index) {
      downloadFile(url, `tiktok-photo-${index + 1}.jpg`);
    }

    function downloadAllPhotos() {
      const data = JSON.parse(sessionStorage.getItem('tiktokData'));
      if (!data.images || !Array.isArray(data.images)) return;
      data.images.forEach((url, i) => {
        setTimeout(() => downloadPhoto(url.trim(), i), i * 400);
      });
      alert(`âœ… Membuka ${data.images.length} foto di tab baru.\nSilakan simpan satu per satu.`);
    }

    async function copyCaption() {
      const data = JSON.parse(sessionStorage.getItem('tiktokData'));
      const caption = data.title || '';
      try {
        await navigator.clipboard.writeText(caption);
        alert("Caption berhasil disalin!");
      } catch (err) {
        const ta = document.createElement('textarea');
        ta.value = caption;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        alert("Caption berhasil disalin!");
      }
    }

    // === INISIALISASI DATA ===
    const rawData = sessionStorage.getItem('tiktokData');
    if (!rawData) {
      document.getElementById('errorSection').style.display = 'block';
    } else {
      const data = JSON.parse(rawData);

      // Isi informasi umum
      document.getElementById('videoTitle').textContent = data.title || 'Tanpa Judul';
      document.getElementById('videoDuration').textContent = data.duration || 'â€“';
      document.getElementById('videoDate').textContent = data.create_time ? formatDate(data.create_time) : 'â€“';
      document.getElementById('videoRegion').textContent = data.region || 'â€“';

      // Thumbnail utama
      const thumbnailImg = document.getElementById('thumbnailImg');
      const coverUrl = data.cover || (data.images?.[0]) || 'https://via.placeholder.com/100';
      thumbnailImg.src = coverUrl.trim();
      thumbnailImg.onerror = () => { thumbnailImg.src = 'https://via.placeholder.com/100'; };

      // Cek jenis konten
      const isPhoto = Array.isArray(data.images) && data.images.length > 0;

      if (isPhoto) {
        // Tampilkan info dasar
        document.getElementById('videoInfoCard').style.display = 'block';
        // Sembunyikan video/audio
        document.getElementById('downloadSection').style.display = 'none';
        document.getElementById('musicSection').style.display = 'none';
        // Tampilkan foto
        document.getElementById('photoSection').style.display = 'block';

        const photoList = document.getElementById('photoList');
        photoList.innerHTML = '';
        data.images.forEach((url, i) => {
          const img = document.createElement('img');
          img.src = url.trim();
          img.alt = `Foto ${i + 1}`;
          img.className = 'photo-item';
          img.onclick = () => downloadPhoto(url.trim(), i);
          photoList.appendChild(img);
        });
      } else {
        // Ini video
        document.getElementById('videoInfoCard').style.display = 'block';
        document.getElementById('downloadSection').style.display = 'block';
        document.getElementById('videoSize').textContent = formatFileSize(data.hd_size);

        if (data.music_info) {
          document.getElementById('musicSection').style.display = 'block';
          document.getElementById('musicTitle').textContent = data.music_info.title || 'â€“';
          document.getElementById('musicAuthor').textContent = data.music_info.author || 'â€“';
          const musicCover = document.getElementById('musicCover');
          musicCover.src = (data.music_info.cover || 'https://via.placeholder.com/60').trim();
          musicCover.onerror = () => { musicCover.src = 'https://via.placeholder.com/60'; };
        }
      }
    }
  </script>
</body>
</html>